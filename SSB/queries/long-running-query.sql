with h as (select lo_partkey, d_year, d_weeknuminyear, sum(lo_revenue) revenue from lineorder, dates where lo_orderdate = d_datekey group by lo_partkey, d_year, d_weeknuminyear) select h0.lo_partkey, h1.d_year, h1. d_weeknuminyear, h0.revenue, h1.revenue, h1.revenue-h0.revenue from h h0, h h1 where h0.lo_partkey = h1.lo_partkey and (h0.d_year = h1.d_year and h0.d_weeknuminyear + 1 = h1.d_weeknuminyear) or (h0.d_year+1 = h1.d_year and h0.d_weeknuminyear = 53 and h1.d_weeknuminyear = 1) order by h1.revenue-h0.revenue asc fetch first 20 rows only;
